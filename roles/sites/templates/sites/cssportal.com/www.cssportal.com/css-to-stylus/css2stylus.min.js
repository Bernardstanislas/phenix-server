/*!
 * css2stylus.js
 * http://css2stylus.com
 * Copyright (c) 2013 Denis Ciccale (@tdecs)
 * Released under the MIT license
 * https://github.com/dciccale/css2stylus.js/blob/master/LICENSE.txt
 */
(function(t){var e=[];"object"==typeof global&&global&&global.global===global&&(t=global);var n={counter:0,isFontFace:function(t){return t.match("@font-face")},tmpFix:function(t){var e=t+this.counter;return this.counter++,e},tmpUnFix:function(t){return t.replace(/\d+$/,"")}},i={Converter:function(t){return this.css=t||"",this.output="",this}};i.Converter.prototype={defaults:{indent:"2",cssSyntax:!1,openingBracket:"",closingBracket:"",semicolon:"",eol:"",unPrefix:!1,keepColons:!1},processCss:function(t){return this.css?(this.options=this._extend({},this.defaults,t),this.options.cssSyntax===!0?(this.options.openingBracket="{",this.options.closingBracket="}",this.options.semicolon=":",this.options.eol=";"):this.options.cssSyntax===!1&&(this.options.semicolon=this.options.keepColons?":":""),"tab"===this.options.indent?this.indentation="	":this.indentation=this._repeat(" ",this.options.indent),this._parse(),this):this.css},_parse:function(){var t={children:{}},n=this;this.css.replace(/\/\*[\s\S]*?\*\//gm,"").replace(/@media[^@]+/gi,function(t){var n=t.replace(/@media[^{]+\{/gi,function(t){return e.push(t.slice(0,-1).trim()),""});return n=n.replace(/[^\n]+\{/gm,function(t){var n=("00"+e.length).slice(-3);return t="media"+n+" "+t}),n=n.replace(/\}[^{]*\}[^@]*/gi,function(t){return t=t.substring(1),t=t.replace(/media\d+\s/gm,"")})}).replace(/([^{]+)\{([^}]+)\}/g,function(e,i,r){var s,o,a,c,u=t;if(n.options.unPrefix&&(r=n._unPrefix(r)),i=n._trim(i),/,/.test(i))u=n._addRule(u,i);else for(i=i.replace(/\s*([>\+~])\s*/g," &$1").replace(/(\w)([:\.])/g,"$1 &$2"),c=i.split(/[\s]+/),s=0,o=c.length;o>s;s++)a=c[s].replace(/&(.)/g,"& $1 ").replace(/& ([:\.]) /g,"&$1"),u=n._addRule(u,a);r.replace(/([^:;]+):([^;]+)/g,function(t,e,i){u.declarations.push({property:n._trim(e),value:n._trim(i)})})}),this.output=this._generateOutput(t)},_unPrefix:function(t){var e={};return t=t.replace(/-\w*-(.*)/g,function(t,n){var i;return e[n]?i="":(e[n]=1,i=n),i}).replace(/^(.*)[\s\n]+\1/gm,"$1")},_counter:0,_addRule:function(t,e){var i;return n.isFontFace(e)&&(e=n.tmpFix(e)),i=t.children[e]=t.children[e]||{children:{},declarations:[]}},_depth:0,_generateOutput:function(t){var i,r,s,o,a,c,u="",p=this.options.openingBracket?" "+this.options.openingBracket:"";for(i in t.children)if(t.children.hasOwnProperty(i)){for(c=i,n.isFontFace(i)&&(c=n.tmpUnFix(i)),u+=this._getIndent()+c+p+"\n",this._depth++,o=t.children[i].declarations,r=0,s=o.length;s>r;r++)a=o[r],u+=this._getIndent()+a.property+this.options.semicolon+" "+a.value+this.options.eol+"\n";u+=this._generateOutput(t.children[i]),this._depth--,u+=this._getIndent()+this.options.closingBracket+"\n"+(0===this._depth?"$n":"")}return u=u.replace(/^\s*$[\n\r]{1,}/gm,"").replace(/\$n/g,"\n"),u=u.replace(/media\d+/gm,function(t){var n=Number(t.substring(5,8))-1;return e[n]})},_getIndent:function(){return this._repeat(this.indentation,this._depth)},getStylus:function(){return this.output},_trim:function(t){return t.replace(/\t+/," ").replace(/^\s+|\s+$/g,"")},_repeat:function(e,n){return n=t.parseInt(n,10),new Array(n+1).join(e)},_extend:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}},t.Css2Stylus=i,"object"==typeof module&&module&&module.exports===exports?module.exports=i:"function"==typeof t.define&&t.define.amd&&t.define("css2stylus",[],function(){return t.Css2Stylus})}).call(this,this);